<!DOCTYPE html>
<html>

<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/loginRegister.css"/>
    <title>Tirebiters</title>
</head>

<body>

<div id="login_div" class="main-div">

    <!-- display login form -->
    <script>
        document.getElementById("login_div").style.display = "block";
    </script>

    <script>
        // this function validates the login information. If the user successfully logs in, go to the FeedPage servlet and
        // redirect them to the feedpage in there. If the login is not successful, alert the user with alert()
        async function validateLogin(){
            //alert("test");
            fetch('LogInServlet')
                .then(response => response.json())
                .then(data => {
                    var isValid = data.isValid;
                    var username = data.username;

                    if(isValid){
                        document.location.href = "FeedPage?username=" + username;
                    }else{
                        alert("The username or password you entered is not valid.");
                    }
                });
        }
    </script>


    <form name="loginForm" method = "GET" action="LoginServlet">
        <h2 style="text-align:center"> Log in to tirebiters </h2>
        <input type="email" placeholder="Username (email)" name="username" id="email_field" required>
        <input type="password" placeholder="Password" name="password" id="password_field" required>
        <input type="submit" name="login" value="üê∂  Login  üê∂" onclick="validateLogin();" >


        <!-- does not use servlets
        <button onclick="login()">Login </button>
        <button onclick="register()">or input new user info and click to register.</button>
        -->
    </form>
    <!-- open register form when clicked on "Don't have an account? Register here" -->
    <div id="Registerbtn" class="Registerbtn">
        <button onclick="document.getElementById('registerForm').style.display='block'"> Don't have an account? Register here</button>
    </div>

    <div id="GuestNavigate" class="GuestNavigate">
        <form action = "explorepage.html">
            <button type="submit" name = "guestNavigate" id = "guestNavigate" >Navigate with a guest account</button>
        </form>
    </div>

</div>


<script>
    // this function validates the registered information. If the user successfully registers, go to the FeedPage servlet and
    // redirect them to the feedpage in there. If it's not successful, alert the user with alert().
    async function validateRegister(){
        //alert("test");
        fetch('RegisterServlet')
        .then(response => response.json())
        .then(data => {
            var passwordsMatch = data.passwordsMatch;
            var isGoodPasswordReqs = data.isGoodPasswordReqs;
            var userTaken = data.userTaken;
            var username = data.username;

            if(!isGoodPasswordReqs){
                alert("Please make sure your password is at least 8 characters long and contains a number and a letter.")
            }
            if(!passwordsMatch){
                alert("Please make sure your passwords match.")
            }
            if(userTaken){
                alert("That username is taken. Please try a new one");
            }
            // if registered info is ok (user is unique and passwords match), go to FeedPage servlet and from there, sendRedirect
            // to feedpage
            if(passwordsMatch && !userTaken){
                document.location.href = "FeedPage?username=" + username;
           }
        });
    }
</script>

<div id="registerForm" class="registerForm">
    <span onclick="document.getElementById('registerForm').style.display='none'" class="close" title="Close registerForm">&times;</span>
<form class = "registerFormContent" method = "GET" action="RegisterServlet">
    <!-- content within register form. Only opens up when click on register-->
        <div class="container">
            <h1>üê∂  Register for Tirebiters!  üê∂</h1>
            <p>Enter the information below to join tirebiters</p>
            <hr>
            <label for="email"><b>Email</b></label>
            <input id="email" type="text" placeholder="Enter Email" name="email" required>

            <label for="displayName"><b>Display Name</b></label>
            <input id="displayName" type="text" placeholder="Enter a display name" name="displayName" required>

            <label for="email"><b>Bio</b></label>
            <input id="bio" type="text" placeholder="Write short bio about yourself!" name="bio" required>

            <label for="password"><b>Password</b></label>
            <input id="password" type="password" placeholder="Enter Password" name="password" required>

            <label for="confirmPassword"><b>Please re-type your password to confirm</b></label>
            <input id="confirmPassword" type="password" placeholder="Confirm Password" name="confirmPassword" required>

            <label for="hasPets"><b>I have pets </b></label>
            <input id="checkPets" type="checkbox" name="hasPets">

            <p>We hope you enjoy tirebiters! Welcome</p>
            <!-- when pressing cancel or register -->
            <div class="clear">
                <button type="button" onclick="document.getElementById('registerForm').style.display='none'" class="cancelbtn">Cancel</button>
                <input type="submit" class="signupbtn" value="Register" onclick="validateRegister();">
            </div>
        </div>
</form>
</div>

<!-- script that handles closing register form -->
<script>
    var registerForm = document.getElementById('registerForm');

    // When the user clicks anywhere outside of the registerForm, close it
    window.onclick = function(event) {
        if (event.target == registerForm) {
            registerForm.style.display = "none";
        }
    }
</script>
</body>
</html>
